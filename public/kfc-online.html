<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KFC Trending Cart & Payment</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background: #f4f6f8;
            padding-bottom: 80px;
            font-family: system-ui;
        }

        .card {
            border-radius: 16px;
            transition: .3s;
        }

        .card:hover {
            transform: translateY(-4px);
        }

        .qty-btn {
            width: 34px;
            height: 34px;
            border-radius: 50%;
        }

        .badge-cart {
            font-size: 14px;
        }

        /* ===== DARK THEME ===== */
        body.dark {
            background: #0f172a;
            color: #e5e7eb;
        }

        body.dark .card {
            background: #111827;
            color: #e5e7eb;
        }

        body.dark .table {
            color: #e5e7eb;
        }

        body.dark .form-control {
            background: #1f2937;
            color: #e5e7eb;
            border-color: #374151;
        }

        body.dark .btn-light {
            background: #1f2937;
            color: #facc15;
        }

        body.dark .btn-outline-danger {
            color: #fca5a5;
            border-color: #fca5a5;
        }

        body.dark .btn-outline-danger:hover {
            background: #7f1d1d;
        }

        body {
            transition: background 0.3s, color 0.3s;
        }

        .addon-card {
            cursor: pointer;
            transition: 0.2s;
        }

        .addon-card input {
            pointer-events: none;
        }


        .addon-card:hover {
            background: #fef2f2;
            border-color: #dc2626;
        }

        body.dark .addon-card:hover {
            background: #1f2937;
        }

        .addon-card {
            cursor: pointer;
            transition: 0.2s;
        }

        .addon-card:hover {
            background: #fef2f2;
            border-color: #dc2626;
        }

        body.dark .addon-card:hover {
            background: #1f2937;
        }
    </style>
</head>

<body class="container my-4">

    <!-- HEADER -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="text-danger">üçó KFC Online Order</h3>
        <span class="badge bg-danger badge-cart">
            üõí Items: <span id="cartCount">0</span>
        </span>
        <button class="btn btn-light border" id="themeToggle" onclick="toggleTheme()">
            üåô
        </button>

    </div>

    <!-- CUSTOMER DETAILS -->
    <div class="card p-3 mb-4">
        <h5>Customer Details</h5>
        <input id="custName" class="form-control mb-2" placeholder="Customer Name">
        <input id="custMobile" class="form-control" placeholder="Mobile Number">
    </div>

    <!-- PRODUCTS -->
    <div class="row g-4">

        <!-- OMG BURGER -->


        <!-- OMG ROLLER -->


    </div>
    <div class="d-flex gap-2 mb-3 mt-4">
        <button class="btn btn-danger btn-sm category-btn" onclick="loadCategory('Chicken')">üçó Chicken</button>
        <button class="btn btn-outline-danger btn-sm category-btn" onclick="loadCategory('Seafood')">üêü Seafood</button>
        <button class="btn btn-outline-danger btn-sm category-btn" onclick="loadCategory('Dessert')">üç∞ Dessert</button>

    </div>
    <!-- REAL FOOD API PRODUCTS -->
    <h4 class="mt-5 mb-3">üçó KFC Chicken Specials</h4>
    <div class="row g-4" id="apiProducts">
        <p class="text-muted">Loading chicken meals...</p>
    </div>
    <!-- FOOD CATEGORIES -->






    <!-- ADDONS -->
    <!-- ADD-ONS FROM API -->
    <div class="card p-3 mt-4">
        <h5 class="mb-3">‚ûï Add-Ons</h5>

        <div class="row g-3" id="addonsContainer">
            <p class="text-muted">Loading add-ons...</p>
        </div>
    </div>


    <!-- CART -->
    <div class="card p-3 mt-4">
        <h5>üõí Cart Summary</h5>

        <table class="table">
            <thead>
                <tr>
                    <th>Item</th>
                    <th>Qty</th>
                    <th>Price</th>
                    <th></th>
                </tr>
            </thead>
            <tbody id="cartBody">
                <tr>
                    <td colspan="4" class="text-center">Cart is empty</td>
                </tr>
            </tbody>
        </table>

        <input id="coupon" class="form-control mb-2" placeholder="Coupon Code (SAVE10)">
        <button class="btn btn-outline-success w-100 mb-2" onclick="applyCoupon()">
            Apply Coupon
        </button>
        <p class="text-success" id="discountMsg"></p>

        <h5 class="text-end">
            Total: ‚Çπ <span id="total">0</span>
        </h5>

        <button class="btn btn-success w-100" onclick="proceedToPayment()">
            Proceed to Payment
        </button>

    </div>

    <!-- PAYMENT MODAL -->
    <div class="modal fade" id="paymentModal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content rounded-4">

                <div class="modal-header">
                    <h5>üí≥ Payment</h5>
                    <button class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">

                    <div class="alert alert-light text-center fw-bold">
                        Pay ‚Çπ <span id="payAmount">0</span>
                    </div>

                    <ul class="nav nav-pills mb-3 justify-content-center">
                        <li class="nav-item">
                            <button class="nav-link active" data-bs-toggle="pill" data-bs-target="#upi">
                                UPI
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" data-bs-toggle="pill" data-bs-target="#card">
                                Card
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" data-bs-toggle="pill" data-bs-target="#cod">
                                COD
                            </button>
                        </li>
                    </ul>

                    <div class="tab-content">

                        <div class="tab-pane fade show active" id="upi">
                            <input class="form-control mb-2" placeholder="UPI ID">
                            <button class="btn btn-success w-100" onclick="payNow()">Pay with UPI</button>
                        </div>

                        <div class="tab-pane fade" id="card">
                            <input class="form-control mb-2" placeholder="Card Number">
                            <div class="row g-2 mb-2">
                                <div class="col"><input class="form-control" placeholder="MM/YY"></div>
                                <div class="col"><input class="form-control" placeholder="CVV"></div>
                            </div>
                            <button class="btn btn-success w-100" onclick="payNow()">Pay with Card</button>
                        </div>

                        <div class="tab-pane fade" id="cod">
                            <p class="text-muted text-center">Pay on delivery üçó</p>
                            <button class="btn btn-success w-100" onclick="payNow()">Confirm Order</button>
                        </div>

                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- SUCCESS MODAL -->
    <div class="modal fade" id="successModal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content text-center p-4 rounded-4">
                <h3 class="text-success">‚úÖ Order Successful</h3>
                <p>Your food is on the way üçîüçó</p>
                <button class="btn btn-danger w-100" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
        <!-- PAYMENT PAGE -->
        <div id="paymentPage" class="container my-4 d-none">

            <!-- HEADER -->
            <div class="d-flex align-items-center mb-3">
                <button class="btn btn-light me-2" onclick="goBack()">‚Üê</button>
                <h4 class="mb-0 fw-bold">Payment</h4>
            </div>

            <!-- ORDER SUMMARY -->
            <div class="card p-3 mb-3">
                <h6 class="fw-bold">Order Summary</h6>
                <div class="d-flex justify-content-between">
                    <span>Total Amount</span>
                    <strong>‚Çπ <span id="payTotal">0</span></strong>
                </div>
                <p class="text-muted small mt-1">
                    Inclusive of all taxes
                </p>
            </div>

            <!-- PAYMENT METHODS -->
            <div class="card p-3 mb-3">
                <h6 class="fw-bold mb-3">Choose Payment Method</h6>

                <!-- UPI -->
                <div class="border rounded p-3 mb-3">
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="payMethod" checked>
                        <label class="form-check-label fw-semibold">
                            UPI (Google Pay / PhonePe / Paytm)
                        </label>
                    </div>
                    <input class="form-control mt-2" placeholder="Enter UPI ID">
                </div>

                <!-- CARD -->
                <div class="border rounded p-3 mb-3">
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="payMethod">
                        <label class="form-check-label fw-semibold">
                            Credit / Debit Card
                        </label>
                    </div>
                    <input class="form-control mt-2" placeholder="Card Number">
                    <div class="row g-2 mt-2">
                        <div class="col">
                            <input class="form-control" placeholder="MM / YY">
                        </div>
                        <div class="col">
                            <input class="form-control" placeholder="CVV">
                        </div>
                    </div>
                </div>

                <!-- COD -->
                <div class="border rounded p-3">
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="payMethod">
                        <label class="form-check-label fw-semibold">
                            Cash on Delivery
                        </label>
                    </div>
                    <p class="text-muted small mt-1">
                        Pay when your order arrives üçó
                    </p>
                </div>
            </div>

            <!-- PAY BUTTON -->
            <div class="card p-3">
                <button class="btn btn-success w-100 fs-5" onclick="confirmPayment()">
                    Pay ‚Çπ <span id="payBtnAmount">0</span>
                </button>
            </div>

        </div>
        <!-- MEAL DETAILS MODAL -->
        <div class="modal fade" id="mealModal">
            <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content rounded-4">

                    <div class="modal-header">
                        <h5 id="mealTitle"></h5>
                        <button class="btn-close" data-bs-dismiss="modal"></button>
                    </div>

                    <div class="modal-body row g-3">
                        <div class="col-md-5">
                            <img id="mealImg" class="img-fluid rounded">
                        </div>
                        <div class="col-md-7">
                            <p id="mealCategory" class="text-muted mb-1"></p>
                            <p id="mealInstructions" style="max-height:160px; overflow:auto"></p>

                            <h5 class="mt-2">‚Çπ <span id="mealPrice"></span></h5>

                            <button class="btn btn-danger mt-3" onclick="addMealFromModal()">
                                Add to Cart
                            </button>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <!-- RECOMMENDED ADD-ONS MODAL -->
        <div class="modal fade" id="recommendAddonModal">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content rounded-4">

                    <div class="modal-header">
                        <h5 class="fw-bold">üî• Recommended Add-Ons</h5>
                        <button class="btn-close" data-bs-dismiss="modal"></button>
                    </div>

                    <div class="modal-body">

                        <div id="recommendedAddons" class="row g-3">
                            <!-- dynamically filled -->
                        </div>

                    </div>

                    <div class="modal-footer">
                        <button class="btn btn-outline-secondary" onclick="skipAddons()">Skip</button>
                        <button class="btn btn-danger" onclick="continueToPayment()">Continue</button>
                    </div>

                </div>
            </div>
        </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        let cart = [];
        let addons = [];
        let discount = 0;
        let recommendationOpen = false;

        /* ---------------- CART LOGIC ---------------- */

        function changeQty(name, price, delta) {
            let item = cart.find(i => i.name === name);

            if (!item && delta > 0) {
                cart.push({ name, price, qty: 1 });
            } else if (item) {
                item.qty += delta;
                if (item.qty <= 0) cart = cart.filter(i => i.name !== name);
            }

            document.getElementById(`qty-${name}`).innerText =
                cart.find(i => i.name === name)?.qty || 0;

            renderCart();
        }

        function toggleAddon(name, price) {
            const i = addons.findIndex(a => a.name === name);
            i > -1 ? addons.splice(i, 1) : addons.push({ name, price });
            renderCart();
        }

        function applyCoupon() {
            discount = coupon.value.trim().toUpperCase() === "SAVE10" ? 0.1 : 0;
            discountMsg.innerText = discount
                ? "10% discount applied üéâ"
                : "Invalid coupon";
            renderCart();
        }

        function renderCart() {
            let body = "";
            let total = 0;

            cart.forEach(i => {
                total += i.qty * i.price;
                body += `
      <tr>
        <td>${i.name}</td>
        <td>${i.qty}</td>
        <td>‚Çπ${i.qty * i.price}</td>
        <td>
          <button class="btn btn-sm btn-danger"
            onclick="changeQty('${i.name}', ${i.price}, -${i.qty})">x</button>
        </td>
      </tr>`;
            });

            addons.forEach(a => {
                total += a.price;
                body += `
      <tr>
        <td>${a.name}</td>
        <td>1</td>
        <td>‚Çπ${a.price}</td>
        <td></td>
      </tr>`;
            });

            total -= total * discount;

            cartBody.innerHTML =
                body || "<tr><td colspan='4' class='text-center'>Cart is empty</td></tr>";

            document.getElementById("total").innerText = total.toFixed(0);
            cartCount.innerText = cart.reduce((s, i) => s + i.qty, 0);
        }

        /* ---------------- PAYMENT FLOW ---------------- */

        function proceedToPayment() {
            if (!custName.value || !custMobile.value) {
                alert("Enter customer details");
                return;
            }

            if (cart.length === 0) {
                alert("Cart is empty");
                return;
            }

            // üî• show recommendations if no addons selected


            openPaymentModal();
        }
        function openPaymentModal() {
            document.getElementById("payAmount").innerText =
                document.getElementById("total").innerText;

            new bootstrap.Modal(
                document.getElementById("paymentModal")
            ).show();
        }


        async function payNow() {
            await placeOrderAPI(); // üî• API CALLED HERE

            bootstrap.Modal.getInstance(
                document.getElementById("paymentModal")
            ).hide();

            new bootstrap.Modal(
                document.getElementById("successModal")
            ).show();

            // reset state
            cart = [];
            addons = [];
            discount = 0;
            document.querySelectorAll("span[id^='qty-']").forEach(e => e.innerText = 0);
            renderCart();
        }

        /* ---------------- THEME ---------------- */

        function toggleTheme() {
            document.body.classList.toggle("dark");
            const isDark = document.body.classList.contains("dark");
            themeToggle.innerText = isDark ? "‚òÄÔ∏è" : "üåô";
            localStorage.setItem("theme", isDark ? "dark" : "light");
        }

        window.addEventListener("load", () => {
            // theme
            if (localStorage.getItem("theme") === "dark") {
                document.body.classList.add("dark");
                themeToggle.innerText = "‚òÄÔ∏è";
            }

            // APIs
            fetchKfcFoodAPI();
            fetchAddonsFromAPI();
        });


        /* ---------------- API ---------------- */

        async function placeOrderAPI() {
            const orderData = {
                customer: custName.value,
                mobile: custMobile.value,
                cart,
                addons,
                total: document.getElementById("total").innerText,
                date: new Date()
            };

            try {
                const res = await fetch("https://jsonplaceholder.typicode.com/posts", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(orderData)
                });

                const result = await res.json();
                console.log("Order saved:", result);
            } catch (err) {
                console.error("Order API failed", err);
            }
        }
        async function fetchKfcFoodAPI() {
            try {
                const res = await fetch(
                    "https://www.themealdb.com/api/json/v1/1/filter.php?c=Chicken"
                );
                const data = await res.json();

                renderFoodProducts(data.meals.slice(0, 6)); // show 6 items
            } catch (error) {
                document.getElementById("apiProducts").innerHTML =
                    "<p class='text-danger'>Failed to load food items</p>";
            }
        }

        function renderFoodProducts(meals) {
            const container = document.getElementById("apiProducts");
            container.innerHTML = "";

            meals.forEach((meal, index) => {
                const price = 150 + index * 20; // realistic KFC pricing
                const name = meal.strMeal.replace(/'/g, "");

                container.innerHTML += `
      <div class="col-md-4">
        <div class="card p-3 text-center h-100">
          <img src="${meal.strMealThumb}"
               class="img-fluid rounded"
               style="height:160px; object-fit:cover">

          <h6 class="mt-2">${name}</h6>
          <p class="fw-bold">‚Çπ${price}</p>

          <div class="d-flex justify-content-center align-items-center gap-2">
            <button class="btn btn-outline-danger qty-btn"
              onclick="changeQty('${name}', ${price}, -1)">‚àí</button>

            <span id="qty-${name}">0</span>

            <button class="btn btn-outline-danger qty-btn"
              onclick="changeQty('${name}', ${price}, 1)">+</button>
          </div>
        </div>
      </div>
    `;
            });
        }

        /* CALL FOOD API ON PAGE LOAD */
        window.addEventListener("load", () => {
            fetchKfcFoodAPI();
        });
        let selectedMeal = null;

        /* ---------- LOAD CATEGORY ---------- */
        function loadCategory(category) {
            document.querySelectorAll(".category-btn")
                .forEach(btn => btn.classList.remove("btn-danger"));

            event.target.classList.add("btn-danger");

            document.getElementById("apiProducts").innerHTML =
                "<p class='text-muted'>Loading...</p>";

            fetch(`https://www.themealdb.com/api/json/v1/1/filter.php?c=${category}`)
                .then(res => res.json())
                .then(data => renderCategoryMeals(data.meals.slice(0, 6), category))
                .catch(() => {
                    apiProducts.innerHTML =
                        "<p class='text-danger'>Failed to load category</p>";
                });
        }


        /* ---------- RENDER MEALS ---------- */
        function renderCategoryMeals(meals, category) {
            const container = document.getElementById("apiProducts");
            container.innerHTML = "";

            meals.forEach((meal, index) => {
                const price = 160 + index * 20;

                container.innerHTML += `
      <div class="col-md-4">
        <div class="card p-3 text-center h-100"
          onclick="openMealModal('${meal.idMeal}', ${price})"
          style="cursor:pointer">
          <img src="${meal.strMealThumb}"
            class="img-fluid rounded"
            style="height:160px; object-fit:cover">
          <h6 class="mt-2">${meal.strMeal}</h6>
          <p class="fw-bold">‚Çπ${price}</p>
        </div>
      </div>
    `;
            });
        }

        /* ---------- OPEN DETAILS MODAL ---------- */
        async function openMealModal(id, price) {
            const res = await fetch(
                `https://www.themealdb.com/api/json/v1/1/lookup.php?i=${id}`
            );
            const data = await res.json();
            const meal = data.meals[0];

            selectedMeal = {
                name: meal.strMeal.replace(/'/g, ""),
                price
            };

            mealTitle.innerText = meal.strMeal;
            mealImg.src = meal.strMealThumb;
            mealCategory.innerText = meal.strCategory;
            mealInstructions.innerText = meal.strInstructions.slice(0, 400) + "...";
            mealPrice.innerText = price;

            new bootstrap.Modal(
                document.getElementById("mealModal")
            ).show();
        }

        /* ---------- ADD FROM MODAL ---------- */
        function addMealFromModal() {
            changeQty(selectedMeal.name, selectedMeal.price, 1);
            bootstrap.Modal.getInstance(
                document.getElementById("mealModal")
            ).hide();
        }
        function toggleAddonFromUI(card, name, price) {
            // ‚úÖ correctly get checkbox inside the clicked card
            const checkbox = card.querySelector(".form-check-input");

            // toggle checkbox state
            checkbox.checked = !checkbox.checked;

            // check if addon already exists
            const index = addons.findIndex(a => a.name === name);

            if (checkbox.checked && index === -1) {
                addons.push({ name, price });
            }

            if (!checkbox.checked && index > -1) {
                addons.splice(index, 1);
            }

            renderCart();
        }
        async function fetchAddonsFromAPI() {
            try {
                const res = await fetch(
                    "https://www.themealdb.com/api/json/v1/1/filter.php?c=Dessert"
                );
                const data = await res.json();

                renderAddons(data.meals.slice(0, 4)); // show 4 add-ons
            } catch (err) {
                document.getElementById("addonsContainer").innerHTML =
                    "<p class='text-danger'>Failed to load add-ons</p>";
            }
        }

        function renderAddons(items) {
            const container = document.getElementById("addonsContainer");
            container.innerHTML = "";

            items.forEach((item, index) => {
                const price = 40 + index * 20; // realistic addon pricing
                const name = item.strMeal.replace(/'/g, "");

                container.innerHTML += `
      <div class="col-md-6">
        <div class="addon-card p-3 border rounded d-flex align-items-center justify-content-between"
             onclick="toggleAddonFromUI(this, '${name}', ${price})">

          <div class="d-flex align-items-center gap-2">
            <img src="${item.strMealThumb}"
                 width="50"
                 height="50"
                 class="rounded"
                 style="object-fit:cover">
            <div>
              <h6 class="mb-1">${name}</h6>
              <small class="text-muted">‚Çπ${price}</small>
            </div>
          </div>

          <input type="checkbox" class="form-check-input">
        </div>
      </div>
    `;
            });
        }

        /* LOAD ADD-ONS ON PAGE LOAD */
        window.addEventListener("load", () => {
            fetchAddonsFromAPI();
        });
        /* ---------- RECOMMENDED ADD-ONS ---------- */

        const recommendedAddonList = [
            { name: "French Fries", price: 60 },
            { name: "Pepsi (500ml)", price: 50 },
            { name: "Chocolate Brownie", price: 80 }
        ];

        function showRecommendedAddons() {
            recommendationOpen = true;

            const container = document.getElementById("recommendedAddons");
            container.innerHTML = "";

            recommendedAddonList.forEach(item => {
                container.innerHTML += `
      <div class="col-12">
        <div class="addon-card p-3 border rounded
             d-flex align-items-center justify-content-between"
             onclick="toggleAddonFromUI(this, '${item.name}', ${item.price})">
          <div>
            <h6 class="mb-1">${item.name}</h6>
            <small class="text-muted">‚Çπ${item.price}</small>
          </div>
          <input type="checkbox" class="form-check-input">
        </div>
      </div>
    `;
            });

            const modalEl = document.getElementById("recommendAddonModal");
            const modal = new bootstrap.Modal(modalEl);

            modalEl.addEventListener("hidden.bs.modal", () => {
                // üî• if user closed modal without clicking buttons
                if (recommendationOpen) {
                    recommendationOpen = false;
                    openPaymentModal();
                }
            }, { once: true });

            modal.show();
        }


        function skipAddons() {
            recommendationOpen = false;
            bootstrap.Modal.getInstance(
                document.getElementById("recommendAddonModal")
            ).hide();
            openPaymentModal();
        }

        function continueToPayment() {
            recommendationOpen = false;
            bootstrap.Modal.getInstance(
                document.getElementById("recommendAddonModal")
            ).hide();
            openPaymentModal();
        }


    </script>


</body>

</html>